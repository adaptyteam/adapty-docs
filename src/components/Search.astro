---
/**
 * Search component using Algolia.
 * Matches Cassiopeia design system with purple accents and clean typography.
 */
import { getUIStrings } from '../locales/ui-strings';

interface Props {
  currentLocale?: string;
}

const { currentLocale } = Astro.props;
const t = getUIStrings(currentLocale).search;

// Map locales to their dedicated Algolia index names.
// Falls back to the default English index when no locale-specific index is configured.
const LOCALE_INDEX: Record<string, string | undefined> = {
  zh: import.meta.env.PUBLIC_ALGOLIA_INDEX_NAME_ZH,
};
const indexName =
  (currentLocale ? LOCALE_INDEX[currentLocale] : undefined) ??
  import.meta.env.PUBLIC_ALGOLIA_INDEX_NAME ??
  '';
---

<div id="search-container" class="relative max-w-md w-full">
  <div class="relative group">
    <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
      <svg class="h-4 w-4 text-slate-400 group-focus-within:text-[#6720ff] transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    </div>
    <input
      type="text"
      id="search-input"
      placeholder={t.placeholder}
      data-i18n-placeholder="searchPlaceholder"
      autocomplete="off"
      autocorrect="off"
      autocapitalize="off"
      spellcheck="false"
      class="block w-full pl-10 pr-3 py-2 bg-slate-50 border border-slate-200 rounded-xl text-[14px] placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-[#6720ff]/10 focus:border-[#6720ff] focus:bg-white transition-all font-medium text-slate-900"
      data-app-id={import.meta.env.PUBLIC_ALGOLIA_APP_ID || ''}
      data-api-key={import.meta.env.PUBLIC_ALGOLIA_SEARCH_KEY || ''}
      data-index-name={indexName}
      data-index-name-default={import.meta.env.PUBLIC_ALGOLIA_INDEX_NAME ?? ''}
      data-index-name-zh={import.meta.env.PUBLIC_ALGOLIA_INDEX_NAME_ZH ?? ''}
      data-analytics-key={import.meta.env.PUBLIC_ALGOLIA_ANALYTICS_KEY || ''}
    />
  </div>

  <!-- Search Results Dropdown -->
  <div
    id="search-results"
    class="absolute mt-2 w-full bg-white rounded-2xl shadow-[0_10px_40px_-10px_rgba(0,0,0,0.15)] border border-slate-100 overflow-hidden z-[100] hidden max-h-[480px] overflow-y-auto"
    data-no-results={t.noResults}
  >
    <!-- Results will be injected here via search.ts -->
  </div>
</div>

<script src="../scripts/search.ts"></script>

<style>
  #search-container {
    color: var(--text-secondary);
  }
  
  #search-input {
    background: var(--bg-secondary) !important;
    border-color: var(--border-primary) !important;
    color: var(--text-primary) !important;
  }
  
  #search-input::placeholder {
    color: var(--text-tertiary) !important;
  }
  
  #search-input:focus {
    background: var(--bg-primary) !important;
    border-color: var(--accent-primary) !important;
  }
  
  #search-results {
    background: var(--bg-primary);
    border-color: var(--border-primary);
    box-shadow: var(--shadow-lg);
  }
  
  /* Search result item styling */
  :global(.search-result-item) {
    border-color: var(--border-primary);
  }
  
  :global(.search-result-item:hover) {
    background: var(--bg-hover) !important;
  }
  
  :global(.search-title) {
    color: var(--text-primary);
  }
  
  :global(.search-result-item:hover .search-title) {
    color: var(--accent-primary) !important;
  }
  
  :global(.search-desc) {
    color: var(--text-secondary);
  }
  
  :global(.search-breadcrumbs) {
    color: var(--text-tertiary);
  }
  
  :global(.text-primary) {
    color: var(--text-primary);
  }
  
  :global(.text-secondary) {
    color: var(--text-secondary);
  }
  
  :global(.text-tertiary) {
    color: var(--text-tertiary);
  }
  
  :global(.text-accent) {
    color: var(--accent-primary);
  }
  
  :global(.bg-hover) {
    background: var(--bg-hover);
  }
  
  :global(.border-primary) {
    border-color: var(--border-primary);
  }
  
  /* Custom scrollbar for the results dropdown */
  #search-results::-webkit-scrollbar {
    width: 6px;
  }
  #search-results::-webkit-scrollbar-track {
    background: transparent;
  }
  #search-results::-webkit-scrollbar-thumb {
    background: #e2e8f0;
    border-radius: 10px;
  }
  #search-results::-webkit-scrollbar-thumb:hover {
    background: #cbd5e1;
  }
</style>
