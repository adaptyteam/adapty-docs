---
title: "Set transaction with server-side API"
description: ""
metadataTitle: ""
displayed_sidebar: APISidebar
---

import Tabs from '@site/src/components/Tabs.astro'; 
import TabItem from '@site/src/components/TabItem.astro'; 
import ProfileResponse from '@site/src/components/reusable/ProfileResponse.md';
import ProfileResponseNotFound from '@site/src/components/reusable/ProfileResponseNotFound.md';
import ProfileResponseUnauthorized from '@site/src/components/reusable/ProfileResponseUnauthorized.md';
import ResponseExample from '@site/src/components/reusable/ResponseExample.md';
import AccessLevelProfileNotFound from '@site/src/components/reusable/AccessLevelProfileNotFound.md';
import Purchase from '@site/src/components/reusable/Purchase.md';
import FreeTrialPrice from '@site/src/components/reusable/FreeTrialPrice.md'; 
import MissingOfferID from '@site/src/components/reusable/MissingOfferID.md'; 
import BillingIssueDetectedDate from '@site/src/components/reusable/BillingIssueDetectedDate.md'; 
import ExpiresDate from '@site/src/components/reusable/ExpiresDate.md'; 
import FamilySharePrice from '@site/src/components/reusable/FamilySharePrice.md'; 
import GracePeriodBilling from '@site/src/components/reusable/GracePeriodBilling.md'; 
import RefundDate from '@site/src/components/reusable/RefundDate.md'; 
import RefundDateNull from '@site/src/components/reusable/RefundDateNull.md'; 
import RenewStatusChangedDate from '@site/src/components/reusable/RenewStatusChangedDate.md'; 
import StoreTransactionId from '@site/src/components/reusable/StoreTransactionId.md'; 
import Subscription from '@site/src/components/reusable/Subscription.md'; 





Creates a new transaction for an end user of your app in Adapty and provides access level. The transaction created by this method will appear in your [analytics](https://app.adapty.io/analytics) and [**Event Feed**](https://app.adapty.io/event-feed) and well as will be sent to all integrations.

This method is recommended over the [Grant access level](api-adapty#/operations/grantAccessLevel) one.

:::important
If the product is not [created in Adapty](create-product), the transaction will still be recorded in the Adapty database, meaning it will appear in analytics and be included in integration events. 

However, the user will get only the default `premium` access level. So, if you want to control access more flexibly and assign different access levels, you must [create products](create-product) in Adapty.
:::

## Method and endpoint

```http
POST https://api.adapty.io/api/v2/server-side-api/purchase/set/transaction/
```

Varies based on whether the purchase is a **subscription** or a **one-time purchase**.

## Example request

<Tabs groupId="api-lang" queryString>  
<TabItem value="curl" label="cURL" default>  

```bash showLineNumbers
curl --location 'https://api.adapty.io/api/v2/server-side-api/purchase/set/transaction/' \
--header 'Authorization: Api-Key <YOUR_SECRET_API_KEY>' \
--header 'adapty-customer-user-id: <YOUR_CUSTOMER_USER_ID>' \
--header 'Content-Type: application/json' \
--data '{
  "purchase_type": "subscription",
  "store": "app_store",
  "environment": "Production",
  "store_product_id": "1year.premium",
  "store_transaction_id": "30002109551456",
  "store_original_transaction_id": "30002109551456",
  "is_family_shared": false,
  "price": {
    "country": "US",
    "currency": "USD",
    "value": 9.99
  },
  "purchased_at": "2022-10-12T09:42:50.000000+0000",
  "variation_id": "81109d24-ea95-4806-9ec7-b482bbd1a33d",
  "originally_purchased_at": "2022-10-12T09:42:50.000000+0000",
  "renew_status": true,
  "expires_at":  "2026-10-12T09:42:50.000000+0000"
}'
```

</TabItem>  
<TabItem value="python" label="Python" default>  

```python showLineNumbers
import requests

url = "https://api.adapty.io/api/v2/server-side-api/purchase/set/transaction/"

payload = {
    "purchase_type": "subscription",
    "store": "app_store",
    "environment": "Production",
    "store_product_id": "1year.premium",
    "store_transaction_id": "30002109551456",
    "store_original_transaction_id": "30002109551456",
    "is_family_shared": False,
    "price": {
        "country": "US",
        "currency": "USD",
        "value": 9.99
    },
    "purchased_at": "2022-10-12T09:42:50.000000+0000",
    "variation_id": "81109d24-ea95-4806-9ec7-b482bbd1a33d",
    "originally_purchased_at": "2022-10-12T09:42:50.000000+0000",
    "renew_status": True,
    "expires_at": "2026-10-12T09:42:50.000000+0000"
}

headers = {
    "Authorization": "Api-Key <YOUR_SECRET_API_KEY>",
    "adapty-customer-user-id": "<YOUR_CUSTOMER_USER_ID>",
    "Content-Type": "application/json"
}

response = requests.post(url, headers=headers, json=payload)

print(response.text)
```

</TabItem>  
<TabItem value="js" label="JavaScript" default>  

```javascript showLineNumbers
const myHeaders = new Headers();
myHeaders.append("adapty-customer-user-id", "<YOUR_CUSTOMER_USER_ID>");
myHeaders.append("Content-Type", "application/json");
myHeaders.append("Authorization", "Api-Key <YOUR_SECRET_API_KEY>");

const raw = JSON.stringify({
  "purchase_type": "subscription",
  "store": "app_store",
  "environment": "Production",
  "store_product_id": "1year.premium",
  "store_transaction_id": "30002109551456",
  "store_original_transaction_id": "30002109551456",
  "is_family_shared": false,
  "price": {
    "country": "US",
    "currency": "USD",
    "value": 9.99
  },
  "purchased_at": "2022-10-12T09:42:50.000000+0000",
  "variation_id": "81109d24-ea95-4806-9ec7-b482bbd1a33d",
  "originally_purchased_at": "2022-10-12T09:42:50.000000+0000",
  "renew_status": true,
  "expires_at": "2026-10-12T09:42:50.000000+0000"
});

const requestOptions = {
  method: "POST",
  headers: myHeaders,
  body: raw,
  redirect: "follow"
};

fetch("https://api.adapty.io/api/v2/server-side-api/purchase/set/transaction/", requestOptions)
  .then((response) => response.text())
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

</TabItem>  
</Tabs>

Placeholders: 

- `<YOUR_CUSTOMER_USER_ID>`: The unique ID of the customer in your system.
- `<YOUR_SECRET_API_KEY>`: Your secret API key for authorization.

### For subscription

<Subscription />

### For one-time purchase

<Purchase />

---

## Successful response: 200: OK

<ProfileResponse />

### Successful response example

