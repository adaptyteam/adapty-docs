---
title: "Google Cloud Storage"
description: "Integrate Google Cloud Storage with Adapty for secure data storage."
metadataTitle: "Google Cloud Storage Integration | Adapty Docs"
---

import ZoomImage from '@site/src/components/ZoomImage.astro';
import Details from '@site/src/components/Details.astro';

Enable the Google Cloud Storage integration to securely store [subscription events](events) and [paywall visit data](paywall-metrics) in one central location: your Google Cloud Storage bucket.

Every day at 4AM UTC, Adapty will upload .csv files with the previous day's data to your buckets. You can choose whether you want to receive **event** data, **paywall visit** data, or **both**. You can also export this data [manually](#manual-data-export) at any time, for any time period.

To set up the integration, [generate a bucket access key](#create-google-cloud-storage-credentials) in your Google Cloud console, and [add it to your Adapty settings](#set-up-google-cloud-storage-integration).

## Upload schedule and duration

Adapty uploads data to Google Cloud Storage every 24 hours, at 0400 UTC.

The files contain data for events created during the previous calendar day (UTC). The file uploaded on March 8th will contain all the events created on March 7th, from 000000 to 235959 UTC.

The process may take up to several hours, depending on the total number of files in the queue, as well as the amount of data you personally requested. If Adapty includes historical data with your first upload, it will take longer than the subsequent daily uploads.

## Set up Google Cloud storage integration

You need to have a valid Google Cloud service account key with **write access**. To generate it, follow the steps in the [create credentials](#create-google-cloud-storage-credentials) section.

:::warning
You can use different buckets with different credentials for events and paywall visits. However, if **either** set of credentials is invalid, [**both uploads will fail**](#troubleshooting).
:::

Go to [**Integrations** -> **Google Cloud Storage**](https://app.adapty.io/integrations/google-cloud-storage), and open the necessary tab (**Events** or **Paywall visits**). Enable the integration.

Upload the file with your **Google Cloud service account key**. Specify the target **bucket** and **folder**. Save your changes.

<ZoomImage id="google-cloud-storage-setup.webp" width="700px" />

### Optional settings for event data

You can specify which events to include in the report, and set custom names for the events. See the [events](events) article for the full list of available events.

<ZoomImage id="event-specific-settings.webp" width="700px" />

| Name                 | Default     | Description |
| ------------------------------ | ----------------- | ----------- |
| Exclude historical events      | true    |   Exclude information about events that occurred before you integrated the Adapty SDK into your app. <br /> <br />If your analytics platform received subscription events **before** you started using Adapty, this option ensures that it does not receive any duplicate events. <Details summary="Practical example"><p>A user purchased a monthly subscription on January 10th. The March 1st update of your application was the first to include the Adapty SDK. <br /> <br /> If this setting is **on**, the report won't include the "subscription started" event from January, nor the "susbcription renewed" event from February. It **will** include the "subscription renewed" event from the 10th of March.</p> </Details> |
| Include events without profile | false | Include transactions that are not linked to a user profile, or cannot be immediately associated with a specific user. These may include purchases made before the Adapty SDK was installed, or transactions received via server notifications. |
| Send user attributes           | false |    Include [custom user attributes](setting-user-attributes), such as user data and app usage data. Select this option if your OneSignal plan supports more than 10 tags. Note that exceeding tag limits may result in errors.  |

## Create Google Cloud Storage credentials

This guide will help you create the necessary credentials in your Google Cloud Platform Console.

In order for Adapty to upload raw data reports to your designated bucket, the service account's key is required, as well as write access to the corresponding bucket. By providing the service account's key and granting write access to the bucket, you allow Adapty to securely and efficiently transfer the raw data reports from its platform to your storage environment.

:::warning
Please note that we only support Service Account HMAC key authorization, means it's essential to ensure that your Service Account HMAC key has the "Storage Object Viewer", "Storage Legacy Bucket Writer" and "Storage Object Creator" roles added to it to enable proper access to Google Cloud Storage.
:::

1. For the first step, you need to go to the [IAM](https://console.cloud.google.com/projectselector2/iam-admin/serviceaccounts) section of your Google Cloud account and choose the relevant project or create a new one.

  <ZoomImage id="30a81ef-CleanShot_2023-03-17_at_15.22.142x.webp" width="700px" />


1. Next, create a new service account for the Adapty by clicking on the "+ CREATE SERVICE ACCOUNT" button.

    <ZoomImage id="98f8ebf-CleanShot_2023-03-17_at_15.40.062x.webp" width="700px" />

2. Fill out the fields in the first step, as access will be granted at a later stage. In order to read more details about this page read the documentation [here](https://cloud.google.com/iam/docs/service-accounts-create).

    <ZoomImage id="2190c50-CleanShot_2023-03-17_at_15.48.552x.webp" width="700px" />

3. To create and download a [private JSON key](https://cloud.google.com/iam/docs/keys-create-delete), navigate to the KEYS section and click on the "ADD KEY" button.

    <ZoomImage id="8a45468-CleanShot_2023-03-17_at_15.58.092x.webp" width="700px" />

4. In the DETAILS section, locate the Email value linked to the recently created service account and make a copy of it. This information will be necessary for the upcoming steps to authorize the account and allow it to write to the bucket.

    <ZoomImage id="6ccd0f0-CleanShot_2023-03-17_at_16.03.162x.webp" width="700px" />
    

5. To proceed go to the Google Cloud Storage's[Buckets](https://console.cloud.google.com/storage/browser) page and either select an existing bucket or create a new one to store the Event or Visuts Data reports from Adapty.  Then navigate to the PERMISSIONS section and select the option to [GRANT ACCESS](https://support.google.com/cloudidentity/answer/9178892?hl=en).

    <ZoomImage id="3cdd937-CleanShot_2023-03-17_at_16.14.232x.webp" width="700px" />

6. In the PERMISSIONS section, input the Email of the service account obtained in the fifth step mentioned earlier, then choose the Storage Object Creator role. Finally, click on SAVE to apply the changes.


    <ZoomImage id="62801f4-CleanShot_2023-03-17_at_16.17.312x.webp" width="700px" />

    Remember to keep the name of the bucket for future reference.

## Manual data export

In addition to the automatic event data export to Google Cloud Storage, Adapty also provides a manual file export functionality. With this feature, you can select a specific time interval for the event data and export it to your GCS bucket manually. This allows you to have greater control over the data you export and when you export it.

The specified date range will be used to export the events created from Date A 00:00:00 UTC up to Date B 23:59:59 UTC.

<ZoomImage id="e347308-CleanShot_2023-03-17_at_17.39.452x.webp" width="700px" />

## Data structure

Adapty uses `.csv` files to export data in a tabular format.

:::warning
Event content may grow over time — with new data being introduced by us or by the 3rd parties we work with. Make sure that your code that processes it is robust enough and relies on the specific fields, but not on the structure as a whole.
:::

### Events

You can [modify](#optional-settings-for-event-data) the list of events that are included in your reports.

| Column | Description |
|------|-----------|
| **profile_id** | Adapty user ID. |
| **event_type** | Lowercased event name. Refer to the [Events](events) section to learn event types. |
| **event_datetime** | ISO 8601 date. |
| **transaction_id** | A unique identifier for a transaction such as a purchase or renewal. |
| **original_transaction_id** | The transaction identifier of the original purchase. |
| **subscription_expires_at** | The Expiration date of subscription. Usually in the future. |
| **environment** | Could be Sandbox or Production. |
| **revenue_usd** | Revenue in USD. Can be empty. |
| **proceeds_usd** | Proceeds in USD. Can be empty. |
| **net_revenue_usd** | Net revenue (income after taxes) in USD. Can be empty. |
| **tax_amount_usd** | Amount of money deducted for taxes in USD. Can be empty. |
| **revenue_local** | Revenue in local currency. Can be empty. |
| **proceeds_local** | Proceeds in local currency. Can be empty. |
| **net_revenue_local** | Net revenue (income after taxes) in local currency. Can be empty. |
| **tax_amount_local** | Amount of money deducted for taxes in local currency. Can be empty. |
| **customer_user_id** | Developer user ID. For example, it can be your user UUID, email, or any other ID. Null if you didn't set it. |
| **store** | Could be *app_store* or *play_store*. |
| **product_id** | Product ID in the Apple App Store, Google Play Store, or Stripe. |
| **base_plan_id** | [Base plan ID](https://support.google.com/googleplay/android-developer/answer/12154973)  in the Google Play Store or [price ID](https://docs.stripe.com/products-prices/how-products-and-prices-work#what-is-a-price)  in Stripe. |
| **developer_id** | Developer (SDK) ID of the paywall where the transaction originated. |
| **ab_test_name** | Name of the A/B test where the transaction originated. |
| **ab_test_revision** | Revision of the A/B test where the transaction originated. |
| **paywall_name** | Name of the paywall where the transaction originated. |
| **paywall_revision** | Revision of the paywall where the transaction originated. |
| **profile_country** | Profile Country determined by Adapty, based on IP. |
| **install_date** | ISO 8601 date when the installation happened. |
| **idfv** | [identifierForVendor](https://developer.apple.com/documentation/uikit/uidevice/1620059-identifierforvendor) on iOS devices |
| **idfa** | [advertisingIdentifier](https://developer.apple.com/documentation/adsupport/asidentifiermanager/advertisingidentifier) on iOS devices |
| **advertising_id** | The Advertising ID is a unique code assigned by the Android Operating System that advertisers might use to uniquely identify a user's device |
| **ip_address** | Device IP (can be IPv4 or IPv6, with IPv4 preferred when available). It is updated each time IP of the device changes |
| **cancellation_reason** | <p>The reason why the user canceled a subscription.</p><p></p><p>Possible values:</p><p>**iOS & Android** — *voluntarily_cancelled*, *billing_error*, *refund*</p><p>**iOS only** — *price_increase*, *product_was_not_available*, *unknown*, *upgraded*</p><p> **Android only** — *new_subscription_replace*, *cancelled_by_developer*</p> |
| **android_app_set_id** | An [AppSetId](https://developer.android.com/design-for-safety/privacy-sandbox/reference/adservices/appsetid/AppSetId) - unique, per-device, per developer-account user-resettable ID for non-monetizing advertising use cases. |
| **android_id** | On Android 8.0 (API level 26) and higher versions of the platform, a 64-bit number (expressed as a hexadecimal string), unique to each combination of app-signing key, user, and device. For more details, see [Android developer documentation](https://developer.android.com/reference/android/provider/Settings.Secure#ANDROID_ID). |
| **device** | The end-user-visible device model name. |
| **currency** | The 3-letter currency code (ISO-4217) of the transaction. |
| **store_country** | Profile Country determined by Apple/Google store. |
| **attribution_source** | Attribution source. |
| **attribution_network_user_id** | ID assigned to the user by attribution source. |
| **attribution_status** | Can be organic, non_organic or unknown. |
| **attribution_channel** | Marketing channel name. |
| **attribution_campaign** | Marketing campaign name. |
| **attribution_ad_group** | Attribution ad group. |
| **attribution_ad_set** | Attribution ad set. |
| **attribution_creative** | Attribution creative keyword. |
| **attributes** | JSON of [custom user attributes](setting-user-attributes#custom-user-attributes). This will include any custom attributes you’ve set up to send from your mobile app. To send it, enable the **Send User Attributes** option in the [Integrations -> Webhooks](https://app.adapty.io/integrations/customwebhook) page. |
| **integration_ids**             | All integration IDs associated with a profile. Dictionary. Example: &#123;&#39;mixpanel_user_id&#39;: &#39;mixpanelUserId-test&#39;, &#39;facebook_anonymous_id&#39;: &#39;facebookAnonymousId-test&#39;&#125;                                                                                                                         |

### Paywall visits

| Column                | Description                                                                                                  |
| :-------------------- | :----------------------------------------------------------------------------------------------------------- |
| **profile_id**        | Adapty user ID.                                                                                              |
| **customer_user_id**  | Developer user ID. For example, it can be your user UUID, email, or any other ID. Null if you didn't set it. |
| **profile_country**   | Profile Country determined by Apple/Google store.                                                            |
| **install_date**      | ISO 8601 date when the installation happened.                                                                |
| **store**             | Could be *app_store* or *play_store*.                                                                        |
| **paywall_showed_at** | The date when the paywall has been displayed to the customer.                                                |
| **developer_id**      | Developer (SDK) ID of the paywall where the transaction originated.                                          |
| **ab_test_name**      | Name of the A/B test where the transaction originated.                                                       |
| **ab_test_revision**  | Revision of the A/B test where the transaction originated.                                                   |
| **paywall_name**      | Name of the paywall where the transaction originated.                                                        |
| **paywall_revision**  | Revision of the paywall where the transaction originated.                                                    |


## Troubleshooting

Adapty checks the validity of your access keys **before** it begins the upload. Even if only one of your Google Cloud Storage keys is invalid, Adapty **aborts the upload** and throws an error.

To ensure uninterrupted uploads, replace your keys before they expire. If you update the key for **events**, don't forget to update the key for **paywall visits**, and vice versa.